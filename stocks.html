<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä ULTIMATE Stock Market Simulator</title>
    <style>
        /* ---------- ROOT & THEME ---------- */
        :root{
            --bg0:#0a0e27;--bg1:#151932;--bg2:#1a1f3a;--acc:#4a9eff;--g:#4ade80;--r:#ef4444;--gray:#8892b0;--text:#e0e0e0;
            --font:'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
        }
        [data-theme="light"]{
            --bg0:#f5f7fa;--bg1:#fff;--bg2:#eef2f7;--acc:#0066cc;--g:#008a00;--r:#d60000;--gray:#555;--text:#111;
        }
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            font-family:var(--font);background:var(--bg0);color:var(--text);line-height:1.6;
            transition:background .3s,color .3s;
        }
        h1,h2,h3{color:var(--acc)}
        button,input,select{font-family:inherit;font-size:1rem;}
        button{cursor:pointer;border:none;border-radius:5px;padding:8px 14px;transition:.2s;}
        button:disabled{opacity:.5;cursor:not-allowed;}
        input,select{padding:8px 12px;border-radius:5px;border:1px solid var(--gray);background:var(--bg1);color:var(--text);}
        /* ---------- LAYOUT ---------- */
        .container{max-width:1500px;margin:0 auto;padding:15px;display:grid;gap:15px;
                   grid-template-areas:
                   "head head"
                   "market port"
                   "news events"
                   "tabs tabs"
                   "foot foot";}
        .head{grid-area:head;background:var(--bg1);padding:15px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
        .market{grid-area:market;background:var(--bg1);padding:15px;border-radius:10px;}
        .port{grid-area:port;background:var(--bg1);padding:15px;border-radius:10px;}
        .news{grid-area:news;background:var(--bg1);padding:15px;border-radius:10px;}
        .events{grid-area:events;background:var(--bg1);padding:15px;border-radius:10px;}
        .tabs{grid-area:tabs;background:var(--bg1);padding:15px;border-radius:10px;}
        .foot{grid-area:foot;text-align:center;font-size:.8em;color:var(--gray);}
        @media(max-width:1000px){.container{grid-template-areas:
                   "head"
                   "market"
                   "port"
                   "news"
                   "events"
                   "tabs"
                   "foot";}}
        /* ---------- COMPONENTS ---------- */
        .positive{color:var(--g)}.negative{color:var(--r)}
        .btn-buy{background:var(--g);color:#fff}.btn-sell{background:var(--r);color:#fff}
        .stock-list{max-height:400px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;}
        .stock-item{display:flex;justify-content:space-between;align-items:center;background:var(--bg2);padding:10px;border-radius:6px;}
        .stock-left{display:flex;flex-direction:column;}
        .stock-symbol{font-weight:bold;font-size:1.1em}
        .stock-name{font-size:.85em;color:var(--gray)}
        .stock-price{text-align:right}
        .portfolio-item{background:var(--bg2);padding:10px;border-radius:6px;margin-bottom:8px;display:flex;justify-content:space-between;}
        .event-banner{padding:10px;border-radius:6px;margin-bottom:10px;font-weight:bold;}
        .event-crash{background:var(--r);color:#fff}.event-boom{background:var(--g);color:#fff}.event-news{background:var(--acc);color:#fff}
        /* ---------- MODAL ---------- */
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:999;align-items:center;justify-content:center;}
        .modal-content{background:var(--bg1);padding:25px;border-radius:10px;max-width:500px;width:90%;}
        .close-modal{float:right;font-size:28px;cursor:pointer;color:var(--gray)}
        /* ---------- TABS ---------- */
        .tab-buttons{display:flex;gap:10px;border-bottom:2px solid var(--bg2);margin-bottom:15px;}
        .tab-btn{background:none;border:none;color:var(--gray);padding:8px 14px;cursor:pointer;}
        .tab-btn.active{color:var(--acc);border-bottom:2px solid var(--acc);}
        .tab-content{display:none;}.tab-content.active{display:block;}
        /* ---------- CHART ---------- */
        #chartCanvas{background:var(--bg2);border-radius:6px;}
    </style>
</head>
<body data-theme="dark">
<div class="container">
    <!-- HEADER -->
    <header class="head">
        <div>
            <h1>üìà Ultimate Stock Market Simulator</h1>
            <p>Real-time ‚Ä¢ Events ‚Ä¢ 200+ Stocks ‚Ä¢ Crypto & Forex</p>
        </div>
        <div style="text-align:right">
            <div style="font-size:2em;font-weight:bold;" id="balanceEl">$100 000</div>
            <div id="plEl" class="positive">+$0 (0%)</div>
            <div style="font-size:.8em;color:var(--gray)">Day <span id="dayEl">1</span></div>
        </div>
    </header>

    <!-- MARKET -->
    <section class="market">
        <h2>Markets</h2>
        <div style="display:flex;gap:8px;margin:10px 0;">
            <input id="searchIn" placeholder="Search ticker (e.g. BTC, AAPL, EURUSD)" style="flex:1">
            <button onclick="searchStocks()">üîç</button>
            <button onclick="filterCategory('all')" class="catBtn">All</button>
            <button onclick="filterCategory('stocks')" class="catBtn">Stocks</button>
            <button onclick="filterCategory('crypto')" class="catBtn">Crypto</button>
            <button onclick="filterCategory('forex')" class="catBtn">Forex</button>
        </div>
        <div id="stockList" class="stock-list"></div>
    </section>

    <!-- PORTFOLIO -->
    <section class="port">
        <h2>Your Portfolio</h2>
        <div id="portfolioTotal" style="margin-bottom:10px;font-size:1.2em;">Total: $0</div>
        <div id="portfolioList"></div>
    </section>

    <!-- NEWS -->
    <section class="news">
        <h2>Market News</h2>
        <div id="newsList"></div>
    </section>

    <!-- EVENTS -->
    <section class="events">
        <h2>Live Events</h2>
        <div id="eventFeed"></div>
    </section>

    <!-- TABS (History,Leader,Settings) -->
    <section class="tabs">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab(this,'history')">History</button>
            <button class="tab-btn" onclick="switchTab(this,'leader')">Leaderboard</button>
            <button class="tab-btn" onclick="switchTab(this,'settings')">Settings</button>
        </div>
        <div id="history" class="tab-content active">
            <h3>Transaction History</h3>
            <div id="historyList" style="max-height:300px;overflow-y:auto;"></div>
        </div>
        <div id="leader" class="tab-content">
            <h3>Leaderboard</h3>
            <div id="leaderList"></div>
        </div>
        <div id="settings" class="tab-content">
            <h3>Settings</h3>
            <label>Starting Balance $<input id="startBalIn" type="number" value="100000"></label><br>
            <label>Theme
                <select id="themeSel" onchange="changeTheme(this.value)">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                </select>
            </label><br>
            <button onclick="resetGame()">üîÑ Reset Game</button>
            <button onclick="togglePause()">‚èØÔ∏è Pause/Resume</button>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="foot">Made with ‚òï by the community ‚Ä¢ <a href="#" style="color:var(--acc)">GitHub</a></footer>
</div>

<!-- Trade Modal -->
<div id="tradeModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <h3 id="modalTitle">Trade</h3>
        <form onsubmit="executeTrade(event)">
            <input type="hidden" id="tradeSymbol">
            <input type="hidden" id="tradeSide">
            <label>Quantity: <input id="tradeQty" type="number" min="1" required oninput="previewTrade()"></label>
            <label>Order:
                <select id="tradeOrderType">
                    <option value="market">Market</option>
                    <option value="limit">Limit</option>
                </select>
            </label>
            <label id="limitBox" style="display:none;">Limit Price: <input id="tradeLimit" type="number" step="0.01"></label>
            <div id="tradePreview" style="background:var(--bg2);padding:10px;border-radius:6px;margin:10px 0;"></div>
            <div style="display:flex;gap:10px;">
                <button type="submit" class="btn-buy" style="flex:1;">Execute</button>
                <button type="button" onclick="closeModal()" style="flex:1;">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- Chart Modal -->
<div id="chartModal" class="modal">
    <div class="modal-content" style="max-width:700px;">
        <span class="close-modal" onclick="closeChartModal()">&times;</span>
        <h3 id="chartTitle">Chart</h3>
        <canvas id="chartCanvas" height="250"></canvas>
    </div>
</div>

<script>
/* ==========================================
   1. CONFIG & STATE
   ========================================== */
const categories={
    stocks:[
        {s:"AAPL",n:"Apple Inc.",v:.02},
        {s:"MSFT",n:"Microsoft",v:.018},
        {s:"GOOGL",n:"Alphabet",v:.025},
        {s:"AMZN",n:"Amazon",v:.03},
        {s:"TSLA",n:"Tesla",v:.05},
        {s:"META",n:"Meta",v:.035},
        {s:"NVDA",n:"NVIDIA",v:.04},
        {s:"NFLX",n:"Netflix",v:.033},
        {s:"JPM",n:"JPMorgan",v:.02},
        {s:"V",n:"Visa",v:.019},
        {s:"DIS",n:"Disney",v:.025},
        {s:"AMD",n:"AMD",v:.042},
        {s:"INTC",n:"Intel",v:.028},
        {s:"PYPL",n:"PayPal",v:.032},
        {s:"UBER",n:"Uber",v:.038},
        {s:"CRM",n:"Salesforce",v:.027},
        {s:"ORCL",n:"Oracle",v:.021},
        {s:"BABA",n:"Alibaba",v:.035},
        {s:"TSMC",n:"TSMC",v:.024},
        {s:"KO",n:"Coca-Cola",v:.015},
        {s:"PFE",n:"Pfizer",v:.022},
        {s:"XOM",n:"Exxon",v:.026},
        {s:"WMT",n:"Walmart",v:.017},
        {s:"HD",n:"Home Depot",v:.02},
        {s:"VZ",n:"Verizon",v:.018},
        {s:"T",n:"AT&T",v:.02},
        {s:"BA",n:"Boeing",v:.04},
        {s:"CAT",n:"Caterpillar",v:.028},
        {s:"MMM",n:"3M",v:.023},
        {s:"IBM",n:"IBM",v:.025}
    ],
    crypto:[
        {s:"BTC",n:"Bitcoin",v:.06},
        {s:"ETH",n:"Ethereum",v:.07},
        {s:"BNB",n:"Binance",v:.08},
        {s:"SOL",n:"Solana",v:.1},
        {s:"ADA",n:"Cardano",v:.09},
        {s:"XRP",n:"Ripple",v:.075},
        {s:"DOT",n:"Polkadot",v:.095},
        {s:"DOGE",n:"Dogecoin",v:.12},
        {s:"AVAX",n:"Avalanche",v:.11},
        {s:"MATIC",n:"Polygon",v:.1}
    ],
    forex:[
        {s:"EURUSD",n:"Euro/US Dollar",v:.005},
        {s:"GBPUSD",n:"Pound/US Dollar",v:.006},
        {s:"USDJPY",n:"US Dollar/Yen",v:.004},
        {s:"AUDUSD",n:"Aussie/US Dollar",v:.007},
        {s:"USDCHF",n:"US Dollar/Franc",v:.0045},
        {s:"USDCAD",n:"US Dollar/Loonie",v:.005},
        {s:"NZDUSD",n:"NZ Dollar/US Dollar",v:.0075},
        {s:"EURJPY",n:"Euro/Yen",v:.006}
    ]
};
let MASTER={}; // all instruments
let portfolio={}; // user positions
let balance=100000;
let startBalance=100000;
let transactions=[];
let day=1;
let paused=false;
let news=[];
let events=[];
let leaders=[{name:"You",val:100000,pl:0}];

/* ==========================================
   2. INIT
   ========================================== */
function init(){
    // build master list
    for(const cat in categories){
        categories[cat].forEach(o=>{
            MASTER[o.s]={...o,cat,price:rand(50,500),hist:[],chg:0,chgPct:0};
        });
    }
    // init hist
    for(const s in MASTER) MASTER[s].hist=[MASTER[s].price];
    renderStocks();
    updatePortfolio();
    updateBalance();
    // loops
    setInterval(marketTick,2000);
    setInterval(randomEvent,15000);
    setInterval(newsCycle,10000);
    // ui
    document.getElementById('searchIn').addEventListener('keypress',e=>{if(e.key==='Enter')searchStocks()});
}
/* ==========================================
   3. MARKET TICK
   ========================================== */
function marketTick(){
    if(paused)return;
    for(const s in MASTER){
        const o=MASTER[s];
        const drift=(Math.random()-0.5)*o.v;
        o.price*= (1+drift);
        o.price=Math.max(0.01,o.price);
        o.hist.push(o.price);
        if(o.hist.length>50)o.hist.shift();
        o.chg= o.hist[o.hist.length-1] - o.hist[0];
        o.chgPct= (o.chg/o.hist[0])*100;
    }
    renderStocks();
    updatePortfolio();
    updateBalance();
}
/* ==========================================
   4. RANDOM EVENTS
   ========================================== */
function randomEvent(){
    if(paused)return;
    const evts=[
        // crashes
        ()=>{const tgt=randPick(Object.keys(MASTER));const drop=rand(0.15,0.35);MASTER[tgt].price*=(1-drop);pushEvent(`üî• CRASH: ${tgt} dives ${(drop*100).toFixed(1)}% on fraud rumors!`,'crash');},
        ()=>{const picks=randPickMany(Object.keys(MASTER),5);const drop=rand(0.05,0.15);picks.forEach(s=>MASTER[s].price*=(1-drop));pushEvent(`üìâ MARKET SELL-OFF: broad decline of ${(drop*100).toFixed(1)}%`,'crash');},
        // booms
        ()=>{const tgt=randPick(Object.keys(MASTER));const pop=rand(0.15,0.3);MASTER[tgt].price*=(1+pop);pushEvent(`üöÄ GOLDEN NEWS: ${tgt} surges ${(pop*100).toFixed(1)}% on earnings beat`,'boom');},
        ()=>{const picks=randPickMany(Object.keys(MASTER),6);const pop=rand(0.05,0.12);picks.forEach(s=>MASTER[s].price*=(1+pop));pushEvent(`üìà SECTOR BOOM: tech/crypto/forex jumps ${(pop*100).toFixed(1)}%`,'boom');},
        // bankruptcy
        ()=>{const tgt=randPick(Object.keys(MASTER));if(MASTER[tgt].price<40){MASTER[tgt].price=0.01;pushEvent(`‚ò†Ô∏è BANKRUPTCY: ${tgt} files Chapter 11 - delisted!`,'crash');}},
        // crypto hack
        ()=>{const cryptos=Object.keys(MASTER).filter(s=>MASTER[s].cat==='crypto');if(cryptos.length){const pick=randPick(cryptos);const drop=rand(0.1,0.2);MASTER[pick].price*=(1-drop);pushEvent(`üíî CRYPTO HACK: ${pick} dumps ${(drop*100).toFixed(1)}% after exchange breach`,'crash');}},
        // fed
        ()=>{const all=Object.keys(MASTER);const mul=rand(-0.08,0.08);all.forEach(s=>MASTER[s].price*=(1+mul));pushEvent(`üè¶ FED SURPRISE: rates shift, markets move ${(mul*100).toFixed(1)}%`,Math.sign(mul)>=0?'boom':'crash');}
    ];
    randPick(evts)();
}
function pushEvent(msg,type){
    events.unshift({msg,type,time:new Date().toLocaleTimeString()});
    if(events.length>15)events.pop();
    renderEvents();
}
/* ==========================================
   5. NEWS
   ========================================== */
function newsCycle(){
    const headlines=[
        "AI Revolution Accelerates","Inflation Data Mixed","Oil Prices Whipsaw","Retail Sales Beat","Jobs Report Shocks","Chip Shortage Eases","Green Energy Boom","Metaverse Spending Spikes","Cyber Attacks Rise","Biotech Breakthrough"
    ];
    news.unshift({title:randPick(headlines),time:new Date().toLocaleTimeString()});
    if(news.length>8)news.pop();
    renderNews();
}
/* ==========================================
   6. PORTFOLIO / BALANCE
   ========================================== */
function updatePortfolio(){
    const list=document.getElementById('portfolioList');
    let total=0;
    let html='';
    for(const s in portfolio){
        const pos=portfolio[s];
        const mkt=MASTER[s].price;
        const val=pos.qty*mkt;
        const pl=(mkt-pos.avg)*pos.qty;
        const plPct=(pl/(pos.avg*pos.qty))*100;
        total+=val;
        html+=`<div class="portfolio-item">
            <div>
                <div><b>${s}</b> ${pos.qty} shr</div>
                <div style="font-size:.8em;color:var(--gray)">avg ${pos.avg.toFixed(2)}</div>
            </div>
            <div style="text-align:right">
                <div><b>${val.toFixed(2)}</b></div>
                <div class="${pl>=0?'positive':'negative'}" style="font-size:.8em">${pl>=0?'+':''}${pl.toFixed(2)} (${plPct.toFixed(2)}%)</div>
            </div>
            <div>
                <button class="btn-sell" onclick="openTrade('${s}','sell')">Sell</button>
            </div>
        </div>`;
    }
    list.innerHTML=html||'<div style="color:var(--gray)">No positions</div>';
    document.getElementById('portfolioTotal').textContent='Total: '+total.toFixed(2);
}
function updateBalance(){
    const total=Object.keys(portfolio).reduce((a,s)=>a+MASTER[s].price*portfolio[s].qty,0)+balance;
    const pl=total-startBalance;
    const plPct=(pl/startBalance)*100;
    document.getElementById('balanceEl').textContent='$'+balance.toFixed(2);
    document.getElementById('plEl').textContent=(pl>=0?'+':'')+pl.toFixed(2)+' ('+plPct.toFixed(2)+'%)';
    document.getElementById('plEl').className=pl>=0?'positive':'negative';
    // leaderboard
    leaders[0].val=total;leaders[0].pl=pl;
    renderLeaders();
}
/* ==========================================
   7. TRADING
   ========================================== */
function openTrade(sym,side){
    const o=MASTER[sym];
    document.getElementById('tradeSymbol').value=sym;
    document.getElementById('tradeSide').value=side;
    document.getElementById('modalTitle').textContent=side.toUpperCase()+' '+sym;
    document.getElementById('tradeQty').value='';
    document.getElementById('tradeOrderType').value='market';
    document.getElementById('tradeLimit').value='';
    document.getElementById('limitBox').style.display='none';
    document.getElementById('tradePreview').innerHTML='';
    document.getElementById('tradeModal').style.display='flex';
}
function closeModal(){document.getElementById('tradeModal').style.display='none';}
function previewTrade(){
    const sym=document.getElementById('tradeSymbol').value;
    const side=document.getElementById('tradeSide').value;
    const qty=parseInt(document.getElementById('tradeQty').value)||0;
    const typ=document.getElementById('tradeOrderType').value;
    const lim=parseFloat(document.getElementById('tradeLimit').value)||0;
    document.getElementById('limitBox').style.display=typ==='limit'?'block':'none';
    const price=typ==='limit'&&lim>0?lim:MASTER[sym].price;
    const total=price*qty;
    let html=`<div>Price: ${price.toFixed(2)}</div><div>Total: ${total.toFixed(2)}</div>`;
    if(side==='buy'&&total>balance)html+='<div class="negative">Insufficient funds</div>';
    if(side==='sell'&&(!portfolio[sym]||portfolio[sym].qty<qty))html+='<div class="negative">Insufficient shares</div>';
    document.getElementById('tradePreview').innerHTML=html;
}
function executeTrade(ev){
    ev.preventDefault();
    const sym=document.getElementById('tradeSymbol').value;
    const side=document.getElementById('tradeSide').value;
    const qty=parseInt(document.getElementById('tradeQty').value);
    const typ=document.getElementById('tradeOrderType').value;
    const lim=parseFloat(document.getElementById('tradeLimit').value)||0;
    const price=typ==='limit'&&lim>0?lim:MASTER[sym].price;
    const total=price*qty;
    if(side==='buy'){
        if(total>balance){showToast('Not enough cash','error');return;}
        balance-=total;
        if(!portfolio[sym])portfolio[sym]={qty:0,avg:0};
        const old=portfolio[sym].qty*portfolio[sym].avg;
        portfolio[sym].qty+=qty;
        portfolio[sym].avg=(old+total)/portfolio[sym].qty;
        transactions.unshift({side,sym,qty,price,total,time:new Date().toLocaleTimeString()});
        showToast(`Bought ${qty} ${sym}`,'success');
    }else{
        if(!portfolio[sym]||portfolio[sym].qty<qty){showToast('Not enough shares','error');return;}
        balance+=total;
        portfolio[sym].qty-=qty;
        const pl=(price-portfolio[sym].avg)*qty;
        if(portfolio[sym].qty===0)delete portfolio[sym];
        transactions.unshift({side,sym,qty,price,total,time:new Date().toLocaleTimeString()});
        showToast(`Sold ${qty} ${sym} P/L ${pl.toFixed(2)}`,pl>=0?'success':'info');
    }
    closeModal();
    updatePortfolio();
    updateBalance();
    renderHistory();
}
/* ==========================================
   8. UI RENDER
   ========================================== */
function renderStocks(){
    const list=document.getElementById('stockList');
    let html='';
    for(const s in MASTER){
        const o=MASTER[s];
        html+=`<div class="stock-item">
            <div class="stock-left">
                <span class="stock-symbol">${s}</span>
                <span class="stock-name">${o.n}</span>
                <span style="font-size:.7em;color:var(--gray)">${o.cat}</span>
            </div>
            <div class="stock-price">
                <div>${o.price.toFixed(2)}</div>
                <div class="${o.chg>=0?'positive':'negative'}" style="font-size:.8em">${o.chg>=0?'+':''}${o.chgPct.toFixed(2)}%</div>
            </div>
            <div style="display:flex;gap:5px;">
                <button onclick="openChart('${s}')">üìä</button>
                <button class="btn-buy" onclick="openTrade('${s}','buy')">Buy</button>
                ${portfolio[s]?'<button class="btn-sell" onclick="openTrade(\''+s+'\',\'sell\')">Sell</button>':''}
            </div>
        </div>`;
    }
    list.innerHTML=html;
}
function renderEvents(){
    const el=document.getElementById('eventFeed');
    el.innerHTML=events.map(e=>`<div class="event-banner event-${e.type}">${e.time} - ${e.msg}</div>`).join('');
}
function renderNews(){
    const el=document.getElementById('newsList');
    el.innerHTML=news.map(n=>`<div style="background:var(--bg2);padding:8px;border-radius:6px;margin-bottom:6px">
        <div style="font-weight:bold">${n.title}</div>
        <div style="font-size:.7em;color:var(--gray)">${n.time}</div>
    </div>`).join('');
}
function renderHistory(){
    const el=document.getElementById('historyList');
    el.innerHTML=transactions.map(t=>`<div style="background:var(--bg2);padding:6px;margin-bottom:4px;border-radius:4px;display:flex;justify-content:space-between;">
        <span>${t.side.toUpperCase()} ${t.qty} ${t.sym} @ ${t.price.toFixed(2)}</span>
        <span>${t.total.toFixed(2)}</span>
    </div>`).join('')||'<div style="color:var(--gray)">No transactions</div>';
}
function renderLeaders(){
    const el=document.getElementById('leaderList');
    el.innerHTML=leaders.map((l,i)=>`<div class="portfolio-item">
        <div><b>#${i+1} ${l.name}</b></div>
        <div>${l.val.toFixed(2)} <span class="${l.pl>=0?'positive':'negative'}">${l.pl>=0?'+':''}${l.pl.toFixed(2)}</span></div>
    </div>`).join('');
}
/* ==========================================
   9. CHART
   ========================================== */
let chartInstance=null;
function openChart(sym){
    document.getElementById('chartTitle').textContent=`${sym} Chart`;
    document.getElementById('chartModal').style.display='flex';
    const ctx=document.getElementById('chartCanvas').getContext('2d');
    if(chartInstance)chartInstance.destroy();
    chartInstance=new Chart(ctx,{
        type:'line',
        data:{
            labels:MASTER[sym].hist.map((_,i)=>i),
            datasets:[{
                label:sym,
                data:MASTER[sym].hist,
                borderColor:MASTER[sym].chg>=0?'var(--g)':'var(--r)',
                backgroundColor:MASTER[sym].chg>=0?'var(--g)20':'var(--r)20',
                tension:.25,
                fill:true
            }]
        },
        options:{responsive:true,plugins:{legend:false},scales:{x:{display:false},y:{ticks:{callback:t=>'$'+t.toFixed(2)}}}}
    });
}
function closeChartModal(){document.getElementById('chartModal').style.display='none';}
/* ==========================================
   10. MISC UTILS
   ========================================== */
function rand(min,max){return Math.random()*(max-min)+min;}
function randPick(arr){return arr[Math.floor(Math.random()*arr.length)];}
function randPickMany(arr,n){return arr.sort(()=>Math.random()-0.5).slice(0,n);}
function showToast(msg,type){
    const t=document.createElement('div');
    t.style.position='fixed';t.style.bottom='20px';t.style.right='20px';t.style.padding='10px 14px';t.style.borderRadius='6px';t.style.color='#fff';t.style.fontWeight='bold';
    t.style.background=type==='error'?'var(--r)':type==='success'?'var(--g)':'var(--acc)';
    t.textContent=msg;
    document.body.appendChild(t);
    setTimeout(()=>t.remove(),2500);
}
function searchStocks(){
    const q=document.getElementById('searchIn').value.toUpperCase();
    if(!q)return;
    const found=Object.keys(MASTER).filter(s=>s.includes(q));
    if(found.length===0){showToast('Ticker not found','error');return;}
    // scroll to first
    document.getElementById('stockList').scrollTop=0;
}
function filterCategory(cat){
    // simple visual filter
    const items=document.querySelectorAll('.stock-item');
    items.forEach(el=>{
        const sym=el.querySelector('.stock-symbol').textContent;
        const c=MASTER[sym].cat;
        el.style.display=(cat==='all'||c===cat)?'flex':'none';
    });
}
function switchTab(btn,tab){
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
}
function changeTheme(v){document.body.setAttribute('data-theme',v);}
function resetGame(){if(confirm('Reset everything?'))location.reload();}
function togglePause(){paused=!paused;showToast(paused?'Paused':'Resumed','info');}
/* ==========================================
   11. START
   ========================================== */
init();
</script>
</body>
</html>
